
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Player.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6c688v72QdOKamCGCT+xaAd', 'Player');
// scripts/Player.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    // 主角跳跃高度
    jumpHeight: 0,
    // 主角跳跃持续时间
    jumpDuration: 0,
    // 最大移动速度
    maxMoveSpeed: 0,
    // 加速度
    accel: 0,
    // 跳跃音效资源
    jumpAudio: {
      "default": null,
      type: cc.AudioClip
    }
  },
  runJumpAction: function runJumpAction() {
    // 跳跃上升
    var jumpUp = cc.tween().by(this.jumpDuration, {
      y: this.jumpHeight
    }, {
      easing: 'sineOut'
    }); // 下落

    var jumpDown = cc.tween().by(this.jumpDuration, {
      y: -this.jumpHeight
    }, {
      easing: 'sineIn'
    }); // 创建一个缓动

    var tween = cc.tween() // 按 jumpUp，jumpDown 的顺序执行动作
    .sequence(jumpUp, jumpDown) // 添加一个回调函数，在前面的动作都结束时调用我们定义的 playJumpSound() 方法
    .call(this.playJumpSound, this); // 不断重复

    return cc.tween().repeatForever(tween);
  },
  playJumpSound: function playJumpSound() {
    // 调用声音引擎播放声音
    cc.audioEngine.playEffect(this.jumpAudio, false);
  },
  onKeyDown: function onKeyDown(event) {
    // set a flag when key pressed
    switch (event.keyCode) {
      case cc.macro.KEY.a:
        this.accLeft = true;
        break;

      case cc.macro.KEY.d:
        this.accRight = true;
        break;
    }
  },
  onKeyUp: function onKeyUp(event) {
    // unset a flag when key released
    switch (event.keyCode) {
      case cc.macro.KEY.a:
        this.accLeft = false;
        break;

      case cc.macro.KEY.d:
        this.accRight = false;
        break;
    }
  },
  //触摸移动；
  onTouchMove: function onTouchMove(event) {
    var self = this;
    var touches = event.getTouches(); //触摸刚开始的位置

    var oldPos = self.node.parent.convertToNodeSpaceAR(touches[0].getStartLocation()); //触摸时不断变更的位置

    var newPos = self.node.parent.convertToNodeSpaceAR(touches[0].getLocation()); //var subPos = cc.pSub(oldPos,newPos); 1.X版本是cc.pSub

    var subPos = oldPos.sub(newPos); // 2.X版本是 p1.sub(p2);

    self.node.x = self.nodePos.x - subPos.x;
    self.node.y = self.nodePos.y - subPos.y; // 控制节点移不出屏幕; 

    var minX = -self.node.parent.width / 2 + self.node.width / 2; //最小X坐标；

    var maxX = Math.abs(minX);
    var minY = -self.node.parent.height / 2 + self.node.height / 2; //最小Y坐标；

    var maxY = Math.abs(minY);
    var nPos = self.node.getPosition(); //节点实时坐标；

    if (nPos.x < minX) {
      nPos.x = minX;
    }

    ;

    if (nPos.x > maxX) {
      nPos.x = maxX;
    }

    ;

    if (nPos.y < minY) {
      nPos.y = minY;
    }

    ;

    if (nPos.y > maxY) {
      nPos.y = maxY;
    }

    ;
    self.node.setPosition(nPos);
  },
  onTouchEnd: function onTouchEnd() {
    this.nodePos = this.node.getPosition(); //获取触摸结束之后的node坐标；
  },
  onTouchCancel: function onTouchCancel() {
    this.nodePos = this.node.getPosition(); //获取触摸结束之后的node坐标；
  },
  // this.node 是需要移动的节点
  onLoad: function onLoad() {
    // 初始化跳跃动作
    var jumpAction = this.runJumpAction();
    cc.tween(this.node).then(jumpAction).start(); // 加速度方向开关

    this.accLeft = false;
    this.accRight = false; // 主角当前水平方向速度

    this.xSpeed = 0; // 初始化键盘输入监听

    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this); //节点初始位置,每次触摸结束更新

    this.nodePos = this.node.getPosition(); //触摸监听(this.node.parent是屏幕)
    //想达到按住节点，节点才能移动的效果，将监听函数注册到 this.node 上，去掉  .parent 即可

    this.node.parent.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);
    this.node.parent.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);
    this.node.parent.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);
  },
  onDestroy: function onDestroy() {
    // 取消键盘输入监听
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);
    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);
  },
  update: function update(dt) {
    // 根据当前加速度方向每帧更新速度
    if (this.accLeft) {
      this.xSpeed -= this.accel * dt;
    } else if (this.accRight) {
      this.xSpeed += this.accel * dt;
    } // 限制主角的速度不能超过最大值


    if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {
      // if speed reach limit, use max speed with current direction
      this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);
    } // 根据当前速度更新主角的位置


    this.node.x += this.xSpeed * dt;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1BsYXllci5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImp1bXBIZWlnaHQiLCJqdW1wRHVyYXRpb24iLCJtYXhNb3ZlU3BlZWQiLCJhY2NlbCIsImp1bXBBdWRpbyIsInR5cGUiLCJBdWRpb0NsaXAiLCJydW5KdW1wQWN0aW9uIiwianVtcFVwIiwidHdlZW4iLCJieSIsInkiLCJlYXNpbmciLCJqdW1wRG93biIsInNlcXVlbmNlIiwiY2FsbCIsInBsYXlKdW1wU291bmQiLCJyZXBlYXRGb3JldmVyIiwiYXVkaW9FbmdpbmUiLCJwbGF5RWZmZWN0Iiwib25LZXlEb3duIiwiZXZlbnQiLCJrZXlDb2RlIiwibWFjcm8iLCJLRVkiLCJhIiwiYWNjTGVmdCIsImQiLCJhY2NSaWdodCIsIm9uS2V5VXAiLCJvblRvdWNoTW92ZSIsInNlbGYiLCJ0b3VjaGVzIiwiZ2V0VG91Y2hlcyIsIm9sZFBvcyIsIm5vZGUiLCJwYXJlbnQiLCJjb252ZXJ0VG9Ob2RlU3BhY2VBUiIsImdldFN0YXJ0TG9jYXRpb24iLCJuZXdQb3MiLCJnZXRMb2NhdGlvbiIsInN1YlBvcyIsInN1YiIsIngiLCJub2RlUG9zIiwibWluWCIsIndpZHRoIiwibWF4WCIsIk1hdGgiLCJhYnMiLCJtaW5ZIiwiaGVpZ2h0IiwibWF4WSIsIm5Qb3MiLCJnZXRQb3NpdGlvbiIsInNldFBvc2l0aW9uIiwib25Ub3VjaEVuZCIsIm9uVG91Y2hDYW5jZWwiLCJvbkxvYWQiLCJqdW1wQWN0aW9uIiwidGhlbiIsInN0YXJ0IiwieFNwZWVkIiwic3lzdGVtRXZlbnQiLCJvbiIsIlN5c3RlbUV2ZW50IiwiRXZlbnRUeXBlIiwiS0VZX0RPV04iLCJLRVlfVVAiLCJOb2RlIiwiVE9VQ0hfTU9WRSIsIlRPVUNIX0VORCIsIlRPVUNIX0NBTkNFTCIsIm9uRGVzdHJveSIsIm9mZiIsInVwZGF0ZSIsImR0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7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LFNBQWYsQ0FBeUJFLE1BQTVDLEVBQW9ELEtBQUt2QyxPQUF6RCxFQUFrRSxJQUFsRTtBQUNILEdBakpJO0FBbUpMOEMsRUFBQUEsTUFBTSxFQUFFLGdCQUFVQyxFQUFWLEVBQWM7QUFDbEI7QUFDQSxRQUFJLEtBQUtsRCxPQUFULEVBQWtCO0FBQ2QsV0FBS29DLE1BQUwsSUFBZSxLQUFLM0QsS0FBTCxHQUFheUUsRUFBNUI7QUFDSCxLQUZELE1BRU8sSUFBSSxLQUFLaEQsUUFBVCxFQUFtQjtBQUN0QixXQUFLa0MsTUFBTCxJQUFlLEtBQUszRCxLQUFMLEdBQWF5RSxFQUE1QjtBQUNILEtBTmlCLENBT2xCOzs7QUFDQSxRQUFLNUIsSUFBSSxDQUFDQyxHQUFMLENBQVMsS0FBS2EsTUFBZCxJQUF3QixLQUFLNUQsWUFBbEMsRUFBaUQ7QUFDN0M7QUFDQSxXQUFLNEQsTUFBTCxHQUFjLEtBQUs1RCxZQUFMLEdBQW9CLEtBQUs0RCxNQUF6QixHQUFrQ2QsSUFBSSxDQUFDQyxHQUFMLENBQVMsS0FBS2EsTUFBZCxDQUFoRDtBQUNILEtBWGlCLENBYWxCOzs7QUFDQSxTQUFLM0IsSUFBTCxDQUFVUSxDQUFWLElBQWUsS0FBS21CLE1BQUwsR0FBY2MsRUFBN0I7QUFDSDtBQWxLSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgLy8g5Li76KeS6Lez6LeD6auY5bqmXG4gICAgICAgIGp1bXBIZWlnaHQ6IDAsXG4gICAgICAgIC8vIOS4u+inkui3s+i3g+aMgee7reaXtumXtFxuICAgICAgICBqdW1wRHVyYXRpb246IDAsXG4gICAgICAgIC8vIOacgOWkp+enu+WKqOmAn+W6plxuICAgICAgICBtYXhNb3ZlU3BlZWQ6IDAsXG4gICAgICAgIC8vIOWKoOmAn+W6plxuICAgICAgICBhY2NlbDogMCxcbiAgICAgICAgLy8g6Lez6LeD6Z+z5pWI6LWE5rqQXG4gICAgICAgIGp1bXBBdWRpbzoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkF1ZGlvQ2xpcFxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICBydW5KdW1wQWN0aW9uOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgLy8g6Lez6LeD5LiK5Y2HXG4gICAgICAgIHZhciBqdW1wVXAgPSBjYy50d2VlbigpLmJ5KHRoaXMuanVtcER1cmF0aW9uLCB7IHk6IHRoaXMuanVtcEhlaWdodCB9LCB7IGVhc2luZzogJ3NpbmVPdXQnIH0pO1xuXG4gICAgICAgIC8vIOS4i+iQvVxuICAgICAgICB2YXIganVtcERvd24gPSBjYy50d2VlbigpLmJ5KHRoaXMuanVtcER1cmF0aW9uLCB7IHk6IC10aGlzLmp1bXBIZWlnaHQgfSwgeyBlYXNpbmc6ICdzaW5lSW4nIH0pO1xuXG4gICAgICAgIC8vIOWIm+W7uuS4gOS4que8k+WKqFxuICAgICAgICB2YXIgdHdlZW4gPSBjYy50d2VlbigpXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmjIkganVtcFVw77yManVtcERvd24g55qE6aG65bqP5omn6KGM5Yqo5L2cXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2VxdWVuY2UoanVtcFVwLCBqdW1wRG93bilcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOa3u+WKoOS4gOS4quWbnuiwg+WHveaVsO+8jOWcqOWJjemdoueahOWKqOS9nOmDvee7k+adn+aXtuiwg+eUqOaIkeS7rOWumuS5ieeahCBwbGF5SnVtcFNvdW5kKCkg5pa55rOVXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2FsbCh0aGlzLnBsYXlKdW1wU291bmQsIHRoaXMpO1xuXG4gICAgICAgIC8vIOS4jeaWremHjeWkjVxuICAgICAgICByZXR1cm4gY2MudHdlZW4oKS5yZXBlYXRGb3JldmVyKHR3ZWVuKTtcbiAgICB9LFxuXG4gICAgcGxheUp1bXBTb3VuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyDosIPnlKjlo7Dpn7PlvJXmk47mkq3mlL7lo7Dpn7NcbiAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheUVmZmVjdCh0aGlzLmp1bXBBdWRpbywgZmFsc2UpO1xuICAgIH0sXG5cbiAgICBvbktleURvd24gKGV2ZW50KSB7XG4gICAgICAgIC8vIHNldCBhIGZsYWcgd2hlbiBrZXkgcHJlc3NlZFxuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuYTpcbiAgICAgICAgICAgICAgICB0aGlzLmFjY0xlZnQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBjYy5tYWNyby5LRVkuZDpcbiAgICAgICAgICAgICAgICB0aGlzLmFjY1JpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBvbktleVVwIChldmVudCkge1xuICAgICAgICAvLyB1bnNldCBhIGZsYWcgd2hlbiBrZXkgcmVsZWFzZWRcbiAgICAgICAgc3dpdGNoKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgY2MubWFjcm8uS0VZLmE6XG4gICAgICAgICAgICAgICAgdGhpcy5hY2NMZWZ0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGNjLm1hY3JvLktFWS5kOlxuICAgICAgICAgICAgICAgIHRoaXMuYWNjUmlnaHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cblxuICAgIFxuIFxuICAgIC8v6Kem5pG456e75Yqo77ybXG4gICAgb25Ub3VjaE1vdmUgKGV2ZW50KSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdmFyIHRvdWNoZXMgPSBldmVudC5nZXRUb3VjaGVzKCk7XG4gICAgICAgIC8v6Kem5pG45Yia5byA5aeL55qE5L2N572uXG4gICAgICAgIHZhciBvbGRQb3MgPSBzZWxmLm5vZGUucGFyZW50LmNvbnZlcnRUb05vZGVTcGFjZUFSKHRvdWNoZXNbMF0uZ2V0U3RhcnRMb2NhdGlvbigpKTtcbiAgICAgICAgLy/op6bmkbjml7bkuI3mlq3lj5jmm7TnmoTkvY3nva5cbiAgICAgICAgdmFyIG5ld1BvcyA9IHNlbGYubm9kZS5wYXJlbnQuY29udmVydFRvTm9kZVNwYWNlQVIodG91Y2hlc1swXS5nZXRMb2NhdGlvbigpKTtcbiAgICAgICAgXG4gICAgICAgIC8vdmFyIHN1YlBvcyA9IGNjLnBTdWIob2xkUG9zLG5ld1Bvcyk7IDEuWOeJiOacrOaYr2NjLnBTdWJcbiBcbiAgICAgICAgdmFyIHN1YlBvcyA9IG9sZFBvcy5zdWIobmV3UG9zKTsgLy8gMi5Y54mI5pys5pivIHAxLnN1YihwMik7XG4gXG4gICAgICAgIHNlbGYubm9kZS54ID0gc2VsZi5ub2RlUG9zLnggLSBzdWJQb3MueDtcbiAgICAgICAgc2VsZi5ub2RlLnkgPSBzZWxmLm5vZGVQb3MueSAtIHN1YlBvcy55O1xuICAgICAgICBcbiAgICAgICAgLy8g5o6n5Yi26IqC54K556e75LiN5Ye65bGP5bmVOyBcbiAgICAgICAgdmFyIG1pblggPSAtc2VsZi5ub2RlLnBhcmVudC53aWR0aC8yICsgc2VsZi5ub2RlLndpZHRoLzI7IC8v5pyA5bCPWOWdkOagh++8m1xuICAgICAgICB2YXIgbWF4WCA9IE1hdGguYWJzKG1pblgpO1xuICAgICAgICB2YXIgbWluWSA9IC1zZWxmLm5vZGUucGFyZW50LmhlaWdodC8yICsgc2VsZi5ub2RlLmhlaWdodC8yOyAvL+acgOWwj1nlnZDmoIfvvJtcbiAgICAgICAgdmFyIG1heFkgPSBNYXRoLmFicyhtaW5ZKTtcbiAgICAgICAgdmFyIG5Qb3MgPSBzZWxmLm5vZGUuZ2V0UG9zaXRpb24oKTsgLy/oioLngrnlrp7ml7blnZDmoIfvvJtcbiBcbiAgICAgICAgaWYgKG5Qb3MueCA8IG1pblgpIHtcbiAgICAgICAgICAgIG5Qb3MueCA9IG1pblg7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChuUG9zLnggPiBtYXhYKSB7XG4gICAgICAgICAgICBuUG9zLnggPSBtYXhYO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoblBvcy55IDwgbWluWSkge1xuICAgICAgICAgICAgblBvcy55ID0gbWluWTtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG5Qb3MueSA+IG1heFkpIHtcbiAgICAgICAgICAgIG5Qb3MueSA9IG1heFk7XG4gICAgICAgIH07XG4gICAgICAgIHNlbGYubm9kZS5zZXRQb3NpdGlvbihuUG9zKTtcbiAgICB9LFxuXG4gICAgb25Ub3VjaEVuZCAoKSB7XG4gICAgICAgIHRoaXMubm9kZVBvcyA9IHRoaXMubm9kZS5nZXRQb3NpdGlvbigpOyAvL+iOt+WPluinpuaRuOe7k+adn+S5i+WQjueahG5vZGXlnZDmoIfvvJtcbiAgICB9LFxuXG4gICAgb25Ub3VjaENhbmNlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLm5vZGVQb3MgPSB0aGlzLm5vZGUuZ2V0UG9zaXRpb24oKTsgLy/ojrflj5bop6bmkbjnu5PmnZ/kuYvlkI7nmoRub2Rl5Z2Q5qCH77ybXG4gICAgfSxcblxuICAgIC8vIHRoaXMubm9kZSDmmK/pnIDopoHnp7vliqjnmoToioLngrlcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyDliJ3lp4vljJbot7Pot4PliqjkvZxcbiAgICAgICAgdmFyIGp1bXBBY3Rpb24gPSB0aGlzLnJ1bkp1bXBBY3Rpb24oKTtcbiAgICAgICAgY2MudHdlZW4odGhpcy5ub2RlKS50aGVuKGp1bXBBY3Rpb24pLnN0YXJ0KClcblxuICAgICAgICAvLyDliqDpgJ/luqbmlrnlkJHlvIDlhbNcbiAgICAgICAgdGhpcy5hY2NMZWZ0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYWNjUmlnaHQgPSBmYWxzZTtcbiAgICAgICAgLy8g5Li76KeS5b2T5YmN5rC05bmz5pa55ZCR6YCf5bqmXG4gICAgICAgIHRoaXMueFNwZWVkID0gMDtcblxuICAgICAgICAvLyDliJ3lp4vljJbplK7nm5jovpPlhaXnm5HlkKxcbiAgICAgICAgY2Muc3lzdGVtRXZlbnQub24oY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9ET1dOLCB0aGlzLm9uS2V5RG93biwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9uKGNjLlN5c3RlbUV2ZW50LkV2ZW50VHlwZS5LRVlfVVAsIHRoaXMub25LZXlVcCwgdGhpcyk7ICAgXG4gICAgICAgIFxuICAgICAgICBcdFx0Ly/oioLngrnliJ3lp4vkvY3nva4s5q+P5qyh6Kem5pG457uT5p2f5pu05pawXG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlUG9zID0gdGhpcy5ub2RlLmdldFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgLy/op6bmkbjnm5HlkKwodGhpcy5ub2RlLnBhcmVudOaYr+Wxj+W5lSlcbiAgICAgICAgICAgICAgICAvL+aDs+i+vuWIsOaMieS9j+iKgueCue+8jOiKgueCueaJjeiDveenu+WKqOeahOaViOaenO+8jOWwhuebkeWQrOWHveaVsOazqOWGjOWIsCB0aGlzLm5vZGUg5LiK77yM5Y675o6JICAucGFyZW50IOWNs+WPr1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnQub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfTU9WRSwgdGhpcy5vblRvdWNoTW92ZSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnBhcmVudC5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQsIHRoaXMub25Ub3VjaEVuZCwgdGhpcyk7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnBhcmVudC5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9DQU5DRUwsIHRoaXMub25Ub3VjaENhbmNlbCwgdGhpcyk7XG4gICAgfSxcblxuICAgIG9uRGVzdHJveSAoKSB7XG4gICAgICAgIC8vIOWPlua2iOmUruebmOi+k+WFpeebkeWQrFxuICAgICAgICBjYy5zeXN0ZW1FdmVudC5vZmYoY2MuU3lzdGVtRXZlbnQuRXZlbnRUeXBlLktFWV9ET1dOLCB0aGlzLm9uS2V5RG93biwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50Lm9mZihjYy5TeXN0ZW1FdmVudC5FdmVudFR5cGUuS0VZX1VQLCB0aGlzLm9uS2V5VXAsIHRoaXMpO1xuICAgIH0sICAgIFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoZHQpIHtcbiAgICAgICAgLy8g5qC55o2u5b2T5YmN5Yqg6YCf5bqm5pa55ZCR5q+P5bin5pu05paw6YCf5bqmXG4gICAgICAgIGlmICh0aGlzLmFjY0xlZnQpIHtcbiAgICAgICAgICAgIHRoaXMueFNwZWVkIC09IHRoaXMuYWNjZWwgKiBkdDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmFjY1JpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLnhTcGVlZCArPSB0aGlzLmFjY2VsICogZHQ7XG4gICAgICAgIH1cbiAgICAgICAgLy8g6ZmQ5Yi25Li76KeS55qE6YCf5bqm5LiN6IO96LaF6L+H5pyA5aSn5YC8XG4gICAgICAgIGlmICggTWF0aC5hYnModGhpcy54U3BlZWQpID4gdGhpcy5tYXhNb3ZlU3BlZWQgKSB7XG4gICAgICAgICAgICAvLyBpZiBzcGVlZCByZWFjaCBsaW1pdCwgdXNlIG1heCBzcGVlZCB3aXRoIGN1cnJlbnQgZGlyZWN0aW9uXG4gICAgICAgICAgICB0aGlzLnhTcGVlZCA9IHRoaXMubWF4TW92ZVNwZWVkICogdGhpcy54U3BlZWQgLyBNYXRoLmFicyh0aGlzLnhTcGVlZCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDmoLnmja7lvZPliY3pgJ/luqbmm7TmlrDkuLvop5LnmoTkvY3nva5cbiAgICAgICAgdGhpcy5ub2RlLnggKz0gdGhpcy54U3BlZWQgKiBkdDtcbiAgICB9LFxufSk7XG5cblxuIl19